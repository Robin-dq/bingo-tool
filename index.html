<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BINGOãƒ„ãƒ¼ãƒ«</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
               "Hiragino Sans", "Hiragino Kaku Gothic ProN",
               "Yu Gothic", Meiryo, sans-serif;
  background: #eee;
  padding: 20px;
  text-align: center;
}

#board-wrapper {
  position: relative;
  max-width: 1448px;
  margin: 0 auto;
}

#board-img {
  width: 100%;
  display: block;
}

#selector {
  position: absolute;
  border: 6px solid #FFD500;
  display: none;
  pointer-events: none;
  z-index: 20;
}

.cell-text {
  position: absolute;
  font-weight: bold;
  color: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: none;
  text-align: center;
}

#saved-image-wrapper {
  margin-top: 20px;
  display: none;
}

#saved-image {
  width: 90%;
  max-width: 1448px;
  border: 2px solid #ccc;
}

#save-hint {
  font-size: 18px;
  margin-top: 10px;
  display: none;
}
</style>
</head>
<body>

<h2>BINGOãƒ„ãƒ¼ãƒ«</h2>

<div id="board-wrapper">
  <img id="board-img" src="bingo_template.jpg">
  <div id="selector"></div>
</div>

<select id="word-list" style="font-size:18px;padding:6px;margin-top:12px;">
  <option value="">æ›²ã‚’é¸æŠ</option>
<option>ãã¿ã‚“ã¡ã¸</option>
<option>ã‚­ãƒŸãƒã‚¦ã‚¿</option>

<option>æœ€çŸ­è·é›¢ã§</option>
<option>ãƒ›ãƒ¼ãƒ ã‚·ãƒƒã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼</option>
<option>ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</option>

<option>ã‚¢ã‚ªã‚¤ã‚ºãƒ </option>
<option>ã‚¢ã‚«ãƒ</option>
<option>ç©ºã¨ãã¿ã®å¼•åŠ›</option>
<option>ãƒ”ã‚¢ãƒç·š</option>
<option>ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼</option>
<option>æããŸã„ä¸–ç•Œ</option>
<option>Ico</option>

<option>88</option>
<option>å½±è¸ã¿</option>
<option>ã‚¦ã‚½ã‚’ã¤ã„ãŸ</option>
<option>å…‰ã‚‹èŠ±</option>
<option>é¢¨ã®å°‘å¥³</option>
<option>ç ‚ã®åŸ</option>

<option>è‰²å½©</option>
<option>ã‚ˆã™ãŒ</option>
<option>ãƒ‘ãƒ¬ãƒ¼ãƒ‰</option>
<option>ãƒ—ãƒ©ãƒã‚¿ãƒªã‚¦ãƒ </option>
<option>ã‚¢ãƒ‰ãƒãƒ«ãƒ¼ãƒ³</option>
<option>ãƒã‚¤ãƒªãƒ¼ãƒ—</option>

<option>ãƒã‚¯ãƒãƒ«ã‚«</option>
<option>ãƒ©ãƒ«ãƒŸãƒ¼</option>
<option>å¤¢è·¯</option>
<option>15ç§’</option>
<option>ä¸Šå¼¦</option>
<option>ç©ºã²ã¨ã¤ãªã„é›²</option>

<option>ä¸–ç•Œç‚¹</option>
<option>ã‚¹ãƒãƒ¼ãƒ‰ãƒ¼ãƒ </option>
<option>ã‚¸ãƒ§ãƒãƒ³ãƒ‹ã®å¤œ</option>

<option>Ã—ãƒ‘ãƒˆãƒªã‚·ã‚¢</option>
<option>æ°´æ€§ã‚­ãƒ£ã‚¹ãƒˆ</option>

<option>Ã—ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ãƒ‘ãƒ¼</option>
<option>ãƒ¬ã‚¤ãƒ³ã‚«ãƒ¼ãƒ†ãƒ³</option>
<option>ç¥ˆã‚Šã†ãŸ</option>

<option>Ã—ãƒãƒŠãƒã‚¤ãƒ­</option>
<option>ãƒãƒ¼ãƒãƒ£ãƒ«ãƒœãƒ¼ã‚¤</option>
<option>èŠ±æ®‹ã‚Šæœˆ</option>

<option>Ã—ç´°èƒã‚­ã‚ªã‚¯</option>
<option>æœˆå½±ã¨ãƒ–ãƒ©ãƒ³ã‚³</option>
<option>ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯</option>

<option>Ã—é¢å½±ãƒ¯ãƒ¼ãƒ—</option>
<option>ç©ºã®å°‘å¹´</option>

<option>ã‚»ãƒ©ãƒˆãƒŠ</option>
<option>é›¨ã‚’å¾…ã¤</option>
<option>ãƒãƒƒãƒ</option>
<option>æ˜Ÿã®å¤œã®è„ˆã®éŸ³ã®</option>
<option>ã¦ã®ã²ã‚‰ã®ãƒãƒªãƒ¼</option>

<option>Ã—ã‚†ãã®ã›ã„</option>

<option>Ã—çµµç©ºäº‹</option>
<option>ãƒã‚¤ã‚¬ãƒ¼ãƒ«</option>
<option>ã‚¢ãƒ³ã‚µãƒ¼ã‚½ãƒ³ã‚°</option>

<option>Ã—ãƒªã‚¢ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰</option>
<option>ãƒ¢ãƒ©ãƒˆãƒªã‚¢ãƒ </option>

<option>ã†ã¤ãã—ã„ä¸–ç•Œ</option>
<option>ã¼ããªã‚Šã®ãŠã¨ãè©±</option>
<option>ãƒŠãƒ³ãƒãƒ¼ã‚¼ãƒ­</option>
<option>ã‚µã‚¯ã‚´ã‚¨</option>
<option>ã‹ãˆã‚Šã¿ã¡</option>
<option>ã‚°ãƒƒãƒã‚¤</option>
<option>æ¶ç©ºç·š</option>

<option>Ã—ã‚‚ã—ã‚‚ã®è©±</option>
<option>å‘¼å¸</option>
<option>ãƒ‘ãƒ«ã‚¹ã‚¿ãƒ¼</option>

<option>Ã—å½±è¸ã¿</option>
<option>å¸°ã‚Šé“</option>

<option>Ã—ã‚¹ã‚¿ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</option>
<option>Ã—æœˆèŠ±</option>
<option>Ã—ãƒ„ãƒãƒ“ã‚¯ãƒ’ãƒˆãƒª</option>

<option>Ã—ãªãªã„ã‚ã³ã‚ˆã‚Š</option>
<option>ãã›ã¤ã®ç”º</option>
<option>ã‚ã¾ã„</option>

<option>ã‚¦ã‚§ãƒ³ãƒ‡ã‚£</option>
<option>ã‚¿ã‚­ã‚ªãƒ³</option>
<option>å¤¢ã®æœã¦</option>
<option>ãƒ—ãƒ©ãƒã‚¿ãƒªã‚¦ãƒ </option>
<option>ãƒãƒ­ãƒ¼</option>
<option>ç—•å½¢</option>
<option>ãƒãƒªãƒ³ã‚¹ãƒãƒ¼</option>
<option>ä¸‰ç­‰æ˜Ÿ</option>
<option>ãƒ¦ãƒ¼ãƒˆãƒ”ã‚¢</option>

<option>Ã—é€æ˜ãªä¸–ç•Œ</option>
<option>çµ¶å¯¾å€¤</option>
<option>ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼</option>

<option>ã“ãŸãˆã‚ã‚ã›</option>
<option>ã‚¹ãƒãƒ¼ãƒ‰ãƒ¼ãƒ </option>
<option>ãƒ«ãƒ¼ãƒš</option>
<option>4åˆ†é–“</option>
<option>ç¥æ§˜</option>
<option>ã‚¢ãƒãƒ­</option>
<option>ãƒ‘ãƒ©ãƒ¬ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰</option>
<option>å˜˜ã¨æœˆ</option>
<option>ãƒ›ã‚¿ãƒ«</option>
<option>ç©ºé£›ã¶ã‚¯ãƒ„</option>
<option>æœ‰è‰²é€æ˜</option>

<option>Ã—ã“ã ã¾ã“ã¨ã ã¾</option>
<option>ã¿ãšãŸã¾ã‚Š</option>
<option>æ—¥ä»˜å¤‰æ›´æˆ¦</option>

<option>åœ°çƒã«é‡</option>

<option>Ã—ãƒ©ã‚¤ãƒ ãƒ„ãƒªãƒ¼</option>
<option>å¸Œæœ›çš„è¦³æ¸¬</option>
<option>ãƒ†ã‚£ãƒ¼ãƒãƒƒãƒˆã®ã‹ã‘ã‚‰</option>

<option>Ã—ã‚¹ãƒãƒ¼ãƒ‰ãƒ­ãƒƒãƒ—</option>
<option>ã‚·ã‚¹ãƒ†ãƒ </option>
<option>ã‚ã¨ã®èŠ±ç«</option>

<option>SN1998A</option>
<option>ãƒ«ãƒŸãƒŠãƒªãƒ¼</option>
<option>ã‚·ã‚¹ãƒ†ãƒ </option>
<option>ã‚¢ãƒŠã‚¶ãƒ¼ã‚¨ãƒ³ãƒ‰</option>
<option>åœ¨å‡¦</option>
<option>ã‚¤ã‚¿ãƒ</option>
<option>ã‚‚ã®ãŒãŸã‚Š</option>
<option>ãƒ‡ã‚£ã‚¢</option>
<option>çµ‚æœ«ã®ãƒ­ãƒ¼ã‚°</option>

<option>Ã—è™šè™šå®Ÿå®Ÿ</option>
<option>ãƒ’ãƒ¼ãƒ­ãƒ¼</option>
<option>æ·±ã</option>

<option>Ã—ã‚¢ã‚¶ãƒ¬ã‚¢</option>
<option>æœ€çµ‚å‰</option>
<option>ã‚¹ã‚¿ãƒ¼ãƒãƒ³ã‚¿ãƒ¼</option>

<option>ã‚¤ãƒ³ã‚½ãƒ ãƒ‹ã‚¢</option>
<option>ãƒãƒ©ãƒªã‚¹</option>
<option>ã‚ãŠã®ã‚‰ããŒã</option>
<option>æœˆå…æ™‚</option>
<option>é›²ã®è½ã¨ã—ç‰©</option>
<option>å¤œã®å¤ªé™½</option>
<option>ã†ã¦ãª</option>
<option>ã‚¹ãƒ†ãƒ </option>

<option>Ã—ã‚¢ã‚¤ã‚·ãƒ¼</option>

<option>Ã—ãƒ¨ãƒ«ã‚¬ã‚ª</option>
<option>ãƒ­ãƒ¼ãƒªã‚¨</option>

<option>Ã—ã‚¨ãƒ³ãƒ–ãƒ¬ãƒ </option>
<option>ãƒˆãƒ­ãƒƒãƒˆ</option>

<option>Ã—ãƒ©ã‚¹ãƒˆãƒãƒ£ãƒ—ã‚¿ãƒ¼</option>

<option>ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ãƒ€ã‚¹ãƒˆ</option>
<option>ã‚¤ãƒˆã‚·ã‚­ãƒ’ãƒ“</option>
<option>ã‚¹ãƒ”ã‚«</option>

<option>ãƒªãƒªãƒªãƒã‚¤ãƒãƒ¼</option>
<option>ã‚ªãƒ¼ãƒ–</option>
<option>èŠ±ã«é›¨</option>
<option>å£°é³´æ–‡</option>

<option>Ã—ã‚½ã‚¢ãƒ¼</option>

<option>Ã—ã‚¯ã‚¨ã‚¹ãƒˆ</option>

<option>ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¿ãƒ¼</option>
<option>ã¤ãã¯ãã‚‚ã‚ˆã†</option>
<option>ãƒã‚³ã«æ—¥ã ã¾ã‚Š</option>
<option>ãƒˆãƒ­ãƒƒãƒˆ</option>
<option>ãƒšã‚«ãƒ‰</option>
<option>ãƒ­ã‚¹</option>
<option>ãƒ–ãƒ­ãƒ¼ãƒ</option>
<option>ã„ãŸã„ã‘ãªæ˜¥ã¨ç©º</option>

<option>Ã—èŠ±ç¯ã‚Š</option>

<option>Ã—å…‰ã®ãªã„è¡—</option>
<option>ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ã‚¿ãƒ¼</option>
<option>æ°´é¡ã®ä¸–ç•Œ</option>

<option>æœˆã®å‡ºã‚‹ä¸˜</option>

<option>Ã—ãƒã‚¸ãƒƒã‚¯ã‚¢ãƒ¯ãƒ¼</option>

<option>Ã—ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹</option>

<option>ãƒˆãƒ­ã‚¤ãƒ¡ãƒ©ã‚¤</option>
<option>æ˜Ÿã«å±Šãã‚ˆ</option>
<option>ã¼ãã¨å¤§äººã¨ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ</option>
<option>ã‚¸ãƒ«ã‚³ãƒ‹ã‚¢</option>
<option>åˆæœŸè¡å‹•</option>
<option>éŒ¯æœˆ</option>
<option>ãƒªãƒŸãƒƒãƒˆ</option>
<option>æœã¦ãªããƒ–ãƒ«ãƒ¼</option>
<option>æ˜Ÿã¨ã¼ãã®åº§æ¨™</option>

<option>Ã—ã—ãšã</option>

</select>

<br>
<input id="username" type="text"
       placeholder="ã‚ãªãŸã®ãŠåå‰"
       style="font-size:18px;padding:6px;width:260px;margin-top:12px;">

<br>
<button id="save-btn"
        style="margin-top:16px;padding:10px 20px;font-size:18px;">
  ç”»åƒç”Ÿæˆãƒœã‚¿ãƒ³
</button>

<div id="saved-image-wrapper">
  <div id="save-hint">ğŸ“Œ ä¸‹ã®ç”»åƒã‚’ä¿å­˜ã—ã¦ãã ã•ã„</div>
  <img id="saved-image" src="">
</div>

<script>
/* å›ºæœ‰ã‚µã‚¤ã‚º */
const IMG_W = 1448, IMG_H = 2048;
const CELL = 222, GAP = 37;
const START_X = 94, START_Y = 701;

let scale = 1;
let selected = null;
const selections = {};

const img = document.getElementById("board-img");
const wrapper = document.getElementById("board-wrapper");
const selector = document.getElementById("selector");
const wordList = document.getElementById("word-list");
const username = document.getElementById("username");

/* æŠ˜ã‚Šè¿”ã—æç”» */
function drawWrappedText(ctx, text, x, y, maxWidth, lineHeight, maxLines = 2) {
  const chars = [...text];
  let line = "";
  let lines = [];

  for (let i = 0; i < chars.length; i++) {
    const test = line + chars[i];
    if (ctx.measureText(test).width > maxWidth) {
      lines.push(line);
      line = chars[i];
      if (lines.length >= maxLines) break;
    } else {
      line = test;
    }
  }
  if (lines.length < maxLines) lines.push(line);

  const total = lines.length * lineHeight;
  const startY = y - total / 2 + lineHeight * 0.85;

  for (let i = 0; i < lines.length; i++) {
    ctx.fillText(lines[i], x, startY + i * lineHeight);
  }
}

/* ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®— */
img.onload = () => updateScale();
window.addEventListener("resize", updateScale);

function updateScale() {
  scale = img.clientWidth / IMG_W;
  updateTexts();
}

function updateTexts() {
  document.querySelectorAll(".cell-text").forEach(el => {
    const r = Number(el.dataset.row);
    const c = Number(el.dataset.col);
    el.style.left = (START_X + c*(CELL+GAP)) * scale + "px";
    el.style.top  = (START_Y + r*(CELL+GAP)) * scale + "px";
    el.style.width  = CELL * scale + "px";
    el.style.height = CELL * scale + "px";
    el.style.fontSize = (36 * scale) + "px";
  });

  if (selected) {
    selector.style.left = (START_X + selected.col*(CELL+GAP)) * scale + "px";
    selector.style.top  = (START_Y + selected.row*(CELL+GAP)) * scale + "px";
    selector.style.width = CELL * scale + "px";
    selector.style.height = CELL * scale + "px";
  }
}

/* ã‚¿ãƒƒãƒ—å‡¦ç† */
function handleTap(e) {
  const rect = wrapper.getBoundingClientRect();
  const x = (e.clientX - rect.left) / scale;
  const y = (e.clientY - rect.top) / scale;

  const col = Math.floor((x - START_X) / (CELL+GAP));
  const row = Math.floor((y - START_Y) / (CELL+GAP));

  if (col < 0 || col > 4 || row < 0 || row > 4) return;
  if (row === 2 && col === 2) return;

  selected = { row, col };

  selector.style.display = "block";
  selector.style.left = (START_X + col*(CELL+GAP)) * scale + "px";
  selector.style.top  = (START_Y + row*(CELL+GAP)) * scale + "px";
  selector.style.width = CELL * scale + "px";
  selector.style.height = CELL * scale + "px";
}

wrapper.addEventListener("click", handleTap);
wrapper.addEventListener("touchstart", e => {
  const t = e.touches[0];
  handleTap({ clientX: t.clientX, clientY: t.clientY });
});

/* æ›²é¸æŠè¡¨ç¤º */
wordList.onchange = () => {
  if (!selected) return;

  const key = `${selected.row}-${selected.col}`;
  selections[key] = wordList.value;

  let el = document.getElementById("cell-" + key);
  if (!el) {
    el = document.createElement("div");
    el.id = "cell-" + key;
    el.className = "cell-text";
    el.dataset.row = selected.row;
    el.dataset.col = selected.col;
    wrapper.appendChild(el);
  }

  el.innerText = wordList.value;
  updateTexts();
};

/* PNGç”Ÿæˆ â†’ ç”»é¢è¡¨ç¤ºï¼ˆé•·æŠ¼ã—ä¿å­˜ç”¨ï¼‰ */
document.getElementById("save-btn").onclick = async () => {

  const canvas = document.createElement("canvas");
  canvas.width = IMG_W;
  canvas.height = IMG_H;
  const ctx = canvas.getContext("2d");

  const bg = new Image();
  bg.crossOrigin = "anonymous";
  bg.src = "bingo_template.jpg";
  await new Promise(res => bg.onload = res);

  ctx.drawImage(bg, 0, 0, IMG_W, IMG_H);

  ctx.font = "bold 36px sans-serif";
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";

  for (const key in selections) {
    const [r, c] = key.split("-").map(Number);
    const txt = selections[key];

    const x = START_X + c*(CELL+GAP) + CELL/2;
    const y = START_Y + r*(CELL+GAP) + CELL/2;

    drawWrappedText(ctx, txt, x, y, CELL - 20, 40, 2);
  }

  const name = username.value.trim();
  if (name) {
    ctx.textAlign = "right";
    ctx.fillText(name, IMG_W - 30, IMG_H - 30);
  }

  const url = canvas.toDataURL("image/png");

  // é•·æŠ¼ã—ä¿å­˜ç”¨ã«è¡¨ç¤ºã™ã‚‹
  const savedImg = document.getElementById("saved-image");
  savedImg.src = url;

  document.getElementById("saved-image-wrapper").style.display = "block";
  document.getElementById("save-hint").style.display = "block";

  window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
};
</script>

</body>
</html>



